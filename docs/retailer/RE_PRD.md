# 3. 소매점(Retailer) 기능 요구사항 상세 (PRD Section)

**대상 사용자:** 농수산물 소매점 주인 (ID: `retailer`)

## 3.0 인증 및 진입 (Authentication & Entry)

| 요구사항 ID | 기능명           | 상세 내용                                                                                                | 연관 스펙    |
| ----------- | ---------------- | -------------------------------------------------------------------------------------------------------- | ------------ |
| R.AUTH.01   | Clerk 인증       | Clerk 기반으로 로그인/회원가입 처리.                                                                     | 2.1.1        |
| R.AUTH.02   | 초기 리다이렉트  | 로그인 성공 시**`/retailer/dashboard`**경로로 자동 이동.                                               | 2.1.1        |
| R.AUTH.03   | 데이터 접근 권한 | Supabase RLS를 통해**본인이 생성하거나 관련된 주문 및 데이터**만 조회 가능. (도매상 PII 접근 불가) | 2.1.1, 2.1.2 |

## 3.1 대시보드 (Bento Home - /retailer/dashboard)

농수산물 소매점 주인의 **재고 관리 및 구매 타이밍 최적화**를 돕는 AI 기반 대시보드입니다. 모듈형 'Bento Grid' 레이아웃을 사용합니다.

| 요구사항 ID | 기능명            | 상세 내용                                                                                                                   | UI/UX 특징                  |
| ----------- | ----------------- | --------------------------------------------------------------------------------------------------------------------------- | --------------------------- |
| R.DASH.01   | 레이아웃          | 모바일/데스크톱 모두 대응하는 유연한**Bento Grid**레이아웃 적용.                                                      | Immersive B2B, Tailwind CSS |
| R.DASH.02   | AI 추천 상품 모듈 | AI가 과거 구매 이력 및 시장 트렌드를 분석하여**"지금 구매해야 할 인기/재고 부족 예상 상품 (특히 제철 농산물)"**리스트 제안. | Invisible AI                |
| R.DASH.03   | 최근 주문 요약    | 최근 완료되거나 진행 중인**주문 3건**을 상태(예: 새벽 배송 준비 중, 일반 배송 중)와 함께 요약 표시.                   | 타임라인 UI 축약본          |
| R.DASH.04   | 긴급 알림/공지    | **특정 농산물(예: 배추)의 재고 부족 알림**또는 플랫폼 공지사항을 눈에 띄게 표시.                                      | Dark Mode 최적화            |

## 3.2 상품 검색 및 탐색 (Smart Search & Exploration)

AI 표준화와 도매점 익명화를 통해 투명하고 안전한 최저가 비교 환경을 제공합니다.

| 요구사항 ID | 기능명           | 상세 내용                                                                                                           | 연관 스펙         |
| ----------- | ---------------- | ------------------------------------------------------------------------------------------------------------------- | ----------------- |
| R.SEARCH.01 | Smart Search     | **Command Palette (Cmd+K)**통합 검색 지원. 농수산물 상품명, 카테고리(예: 엽채류, 근채류), 주문 내역 등을 통합 검색. | 2.1.3             |
| R.SEARCH.02 | AI 상품명 정제   | 검색 결과 및 리스트는**AI가 정제한 표준 상품명/규격**으로만 표시. (예: GAP 인증 고랭지 배추 10kg 특품)        | 1.4               |
| R.SEARCH.03 | 배송 필터링      | 필터 옵션에**'새벽 배송 가능'**필터를 추가하여, 소매점의 운영 시간에 맞춘 상품만 조회 가능.                         | 2.1.3             |
| R.SEARCH.04 | 도매 정보 익명화 | 상품 리스트 및 상세 페이지에서 도매 상호명 대신**익명 식별자 (예: Partner #F2B-01)**및 대략적 지역(시/구)만 노출.   | 2.1.2 (핵심 보안) |
| R.SEARCH.05 | 장바구니 추가    | 상품 상세 페이지에서 수량(단위: Kg, Box 등) 입력 후**'장바구니 담기'**버튼을 통해 상품 추가.                        | N/A               |

## 3.3 장바구니 (Shopping Cart)

| 요구사항 ID | 기능명         | 상세 내용                                                                        | UI/UX 특징                                     |
| ----------- | -------------- | -------------------------------------------------------------------------------- | ---------------------------------------------- |
| R.CART.01   | 상품 목록 관리 | 장바구니에 담긴 상품 목록 (표준명, 익명 판매자, 수량, 가격) 표시.                | 실시간 금액 반영                               |
| R.CART.02   | 수량/삭제 수정 | 장바구니 내에서 각 상품의 수량(단위)을 실시간으로 수정하거나 목록에서 삭제 가능. | 즉각적인 피드백                                |
| R.CART.03   | 예상 총합계    | 상품 총액, 배송비(예상), 최종 결제 예상 금액을 명확하게 요약하여 표시.           | Sticky Footer                                  |
| R.CART.04   | 주문 이동      | 확인 후**'주문하기'**버튼 클릭 시 다음 단계 (3.4 주문/결제)로 이동.              | Validation 체크 (최소 주문 수량, 마감 시간 등) |

## 3.4 주문 및 결제 (Order & Payment)

소매점의 운영 시간을 고려한 배송 시간 지정 기능과 안전한 분할 정산 환경을 위한 결제 모듈입니다.

| 요구사항 ID | 기능명         | 상세 내용                                                                                                                                                        | 연관 스펙             |
| ----------- | -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- |
| R.ORDER.01  | 배송 옵션 선택 | 주문서 작성 시, 도매상이 설정한 옵션(새벽/일반) 중**하나를 선택**해야 함.                                                                                  | 2.1.3                 |
| R.ORDER.02  | 배송 시간 지정 | 선택한 옵션에 따라, 도매상이 설정한**배송 가능 시간대**내에서 소매점이 원하는**배송 예정 시간**을 선택. (가게 오픈 시간에 맞추어 배송받는 니즈 충족) | UI: Wheel Time Picker |
| R.ORDER.03  | Toss Payments  | 결제 수단 선택 시**TossPayments 일반 결제**API 연동.                                                                                                       | 1.4, 2.1.3            |
| R.ORDER.04  | 수취인 플랫폼  | 결제 시 수취인은**플랫폼 (Farm to Biz)**명의로 진행되어야 함.                                                                                                    | 2.1.3                 |
| R.ORDER.05  | 데이터 무결성  | 최종 결제 전, 클라이언트 측의 주문 금액과 서버 측의 실제 재고/가격 기반 금액을 대조하여 무결성 검증.                                                             | 2.2                   |

## 3.5 거래 후 관리 (My Page & History)

| 요구사항 ID | 기능명         | 상세 내용                                                                                                           | UI/UX 특징        |
| ----------- | -------------- | ------------------------------------------------------------------------------------------------------------------- | ----------------- |
| R.MY.01     | 주문 상태 조회 | 주문 내역 페이지에서 각 주문의 상태 (접수, 준비, 배송 중, 완료, 취소) 및 상세 정보 조회.                            | Supabase RLS 적용 |
| R.MY.02     | 배송 타임라인  | 주문 상세 페이지에 배송 상태 변화 및**선택한 배송 예정 시간**을 시각적으로 표시하는**타임라인 UI**제공. | 2.1.3             |
| R.MY.03     | 구매 확정      | '배송 완료' 상태 주문 건에 대해**'구매 확정' 버튼**제공. 클릭 시 정산 로직이 트리거됨.                              | 2.1.5             |

## 3.6 통합 CS/AI 인터페이스 (Unified AI Interface)

| 요구사항 ID | 기능명               | 상세 내용                                                                                                            | 연관 스펙 |
| ----------- | -------------------- | -------------------------------------------------------------------------------------------------------------------- | --------- |
| R.AI.01     | 통합 인터페이스      | 모든 페이지 하단에**Floating Action Button**으로 AI 봇 호출 기능 제공.                                         | 2.1.6     |
| R.AI.02     | Command Palette 통합 | **Cmd+K**실행 시 상품 검색과 AI 봇 질의를 모두 수행할 수 있는 인터페이스 제공.                                 | 2.1.6     |
| R.AI.03     | 배송 가능 질의       | AI 봇이 도매점의 배송 설정 데이터를 조회하여 배송 가능 여부(예: "Partner #F2B-01의 고랭지 무 새벽 배송 돼?")에 답변. | 2.1.6     |
| R.AI.04     | PII 마스킹           | AI 응답 생성 과정에서 도매점의 민감한 개인 정보(상호명, 연락처 등)가 노출되지 않도록**마스킹 처리 필수** .     | 2.1.2     |
