# TODO - 소매점(Retailer) 기능 개발

 프로젝트 MarketLink 소매점 사이트
 업데이트 2024-12-XX (PRD 기반 재정비)
 문서 [RE_PRD.md](docsretailerRE_PRD.md) 참조

---

## 📋 개발 로드맵

```
Phase 1 인증 & 기본 구조 (완료)
Phase 2 상품 탐색 & 장바구니 (완료)
Phase 3 주문 & 결제 (진행 중)
Phase 4 거래 관리 & 마이페이지 (진행 중)
Phase 5 AI & 최적화 (예정)
```

---

## Phase 1 인증 & 진입 (R.AUTH) 🔐

PRD 3.0 섹션 참조.

### 1.1 인증 시스템 (R.AUTH.01)

- [X] Clerk 초기 설정
  - [X] Clerk 프로젝트 연동 및 환경변수 설정
  - [X] 로그인회원가입 페이지 (`sign-in`, `sign-up`)
  - [X] 한국어 로컬라이제이션
- [X] 소매점 역할 관리
  - [X] 역할 선택 페이지 (`role-selection`)
  - [X] 소매점(`retailer`) 메타데이터 연동
- [X] 도매 계정 중복 가입 차단
  - [X] 회원가입 페이지에서 도매 계정 감지 로직
  - [X] 도매 계정 중복 가입 시 차단 모달 표시
  - [X] 모달에서 도매점 로그인 페이지로 이동 옵션 제공
- [X] 일반 중복 가입 처리
  - [X] 이미 가입된 계정으로 회원가입 시도 시 모달 표시
  - [X] "이미 가입된 계정입니다" 모달 UI 구현
  - [X] 모달에서 로그인 페이지로 이동 기능 구현

### 1.2 진입 및 보안 (R.AUTH.02, R.AUTH.03)

- [X] 초기 리다이렉트 (R.AUTH.02)
  - [X] 로그인 시 `retailerdashboard`로 이동
  - [X] 미인증 사용자 접근 차단 (Middleware)
- [ ] 데이터 접근 권한 (R.AUTH.03)
  - [ ] Supabase RLS 정책 수립 (본인 주문만 조회)
  - [ ] 도매점 PII(개인정보) 접근 차단 정책

### 1.3 레이아웃구조

- [X] Retailer 공통 레이아웃
  - [X] `retailer` 경로 레이아웃 (`layout.tsx`)
  - [X] 모바일 대응 사이드바헤더 (`page-header.tsx`, `sidebar.tsx`)
  - [X] 페이지별 동적 타이틀 처리
  - [X] 사이드바 사용자 프로필 메뉴
    - [X] 상단 프로필 영역 (아바타, 이름, 이메일)
    - [X] 하단 고정 메뉴 (프로필 수정, 로그아웃)
    - [X] 로그아웃 시 소매업자 로그인 페이지로 리다이렉트

---

## Phase 2 대시보드 & 상품 탐색 🛒

PRD 3.1, 3.2, 3.3 섹션 참조.

### 2.1 대시보드 (R.DASH)

- [X] Bento Grid 레이아웃 (R.DASH.01)
  - [X] 반응형 대시보드 UI 구현
- [X] AI 추천 상품 (R.DASH.02)
  - [X] 추천 상품 UI 카드 구현
  - [X] 지금 구매해야 할 상품 리스트
- [X] 주문알림 요약 (R.DASH.03, R.DASH.04)
  - [X] 최근 주문 상태 요약 컴포넌트
  - [X] 재고 부족긴급 공지 알림 UI
- [X] 대시보드 기능 정리
  - [X] 실시간 시세표 삭제
  - [X] 긴급 알림 삭제
  - [X] 월별 구매 추이 차트 삭제
- [X] 레이아웃 구조 개선
  - [X] 사이드바 완전 삭제
  - [X] 헤더에 네비게이션 메뉴 통합
  - [X] "대시보드" → "홈"으로 변경
  - [X] 반응형 헤더 네비게이션 구현 (데스크톱: 가로 메뉴, 모바일: 햄버거 메뉴)

### 2.2 상품 검색 (R.SEARCH)

- [X] Smart Search (R.SEARCH.01)
  - [X] Command Palette (`Cmd+K`) 구현
  - [X] 상품명카테고리 검색 기능
- [X] 상품 리스트 & 필터 (R.SEARCH.02, R.SEARCH.03)
  - [X] 상품 목록 페이지 UI
  - [X] 카테고리배송 필터링 UI
- [X] 상품 상세 & 익명화 (R.SEARCH.04)
  - [X] 상품 상세 페이지 구현
  - [X] 도매점 정보 익명화 처리 (예 Partner #F2B-01)
  - [X] 실제 DB 데이터 연동 (데모 데이터 제거)
  - [X] 상품 목록 페이지 재고 표시 수정 (stock_quantity 필드 사용)
  - [X] "전체" 카테고리 버튼 클릭 시 상품 목록 표시 오류 수정
    - [X] initialCategory 동기화 추가
    - [X] updateURL 함수에서 "all" 값 처리 로직 수정
- [X] 장바구니 담기 (R.SEARCH.05)
  - [X] 수량 선택 및 장바구니 추가 버튼
  - [X] 상품 목록 페이지에서 장바구니 추가 기능 구현
    - [X] 장바구니 담기 버튼 클릭 시 상세 페이지로 이동 (수량 선택 후 장바구니 추가는 상세 페이지에서 진행)
  - [X] 상품 상세 페이지에서 장바구니 담기 기능 구현
    - [X] 수량 선택 (1부터 재고까지)
    - [X] 장바구니 담기 버튼 클릭 시 장바구니 페이지로 이동
    - [X] 바로구매 버튼 클릭 시 결제 페이지로 이동
  - [X] 장바구니 추가 후 장바구니 페이지로 자동 이동

### 2.3 장바구니 (R.CART)

- [X] 장바구니 관리 (R.CART.01, R.CART.02)
  - [X] 장바구니 목록 UI
  - [X] 수량 변경 및 삭제 기능
    - [X] 수량 증가/감소 버튼 동작 구현
    - [X] 최소 주문 수량 및 재고 검증
    - [X] 상품 삭제 기능 구현
  - [X] 전체 선택 기능
    - [X] 전체 선택/해제 기능 구현
    - [X] 개별 선택/해제 기능 구현
    - [X] 선택 삭제 기능 구현
    - [X] 선택된 항목만 주문 요약에 반영
  - [X] 상태 관리 (ZustandLocal Storage)
- [X] 주문 예상 (R.CART.03, R.CART.04)
  - [X] 예상 결제 금액 계산
  - [X] 최소 주문 수량 검증

---

## Phase 3 주문 & 결제 💳

PRD 3.4 섹션 참조.

### 3.1 주문서 작성 (R.ORDER.01, R.ORDER.02)

- [X] 주문서 UI
  - [X] 주문 상품 요약 표시
    - [X] 실제 장바구니 데이터 연동
    - [X] 장바구니 비어있을 시 리다이렉트 처리
  - [X] 배송지 정보 입력 폼
  - [X] 페이지 헤더 제목 설정 (주문/결제 페이지 → "결제"로 표시)
- [X] 배송 옵션 (R.ORDER.01)
  - [X] 새벽일반 배송 선택 UI
- [X] 배송 시간 (R.ORDER.02)
  - [X] 배송 희망 시간 선택 UI

### 3.2 결제 처리 (R.ORDER.03-05)

- [X] 결제 수단 선택 (R.ORDER.03)
  - [X] 결제 수단(카드간편결제) 선택 UI
  - [X] 결제 버튼 클릭 핸들러 구현 (기본 구조)
- [X] PG 연동 (R.ORDER.03)
  - [X] Toss Payments SDK 설치 및 연동
  - [X] 결제 승인실패 처리
  - [X] 토스 결제 테스트 페이지 구현 (`/retailer/payment/test`)
    - [X] 임시 토스 결제 테스트 페이지 생성
    - [X] 나중에 실제 결제 플로우와 연결 가능하도록 구조화
- [X] 주문 생성 (R.ORDER.05)
  - [X] 주문 데이터 검증 및 DB 생성 (Server Action)
    - [X] DB 마이그레이션: orders 테이블에 delivery_option, delivery_time, payment_key, paid_at 필드 추가
    - [X] create-payment.ts: 서버 측 가격/재고 검증 (데이터 무결성)
    - [X] create-order.ts: 결제 성공 후 주문 생성 Server Action
    - [X] 결제 성공 페이지: 주문 생성 및 장바구니 비우기 연동
    - [X] 주문 내역 페이지 연동 (생성된 주문 조회 가능)

---

## Phase 4 거래 관리 & 마이페이지 📦

PRD 3.5 섹션 참조.

### 4.1 주문 내역 (R.MY.01, R.MY.02)

- [X] 주문 목록 조회 (R.MY.01)
  - [X] 주문 리스트 UI 및 상태 필터
    - [X] 상태 필터 버튼 기능 (전체, 주문완료, 배송중, 배송완료, 주문취소)
    - [X] 상태별 필터링 로직 구현
  - [X] 주문 상세 페이지 UI
  - [X] 상품명 및 주문번호 검색 기능 (R.SEARCH.01)
    - [X] 검색창 UI 구현
    - [X] 실시간 검색 필터링 로직
    - [X] 상품명 및 주문번호 검색 지원
    - [X] 검색과 상태 필터 동시 적용 지원
- [X] 배송 타임라인 (R.MY.02)
  - [X] 주문 진행 상태 타임라인 시각화

### 4.2 구매 확정 (R.MY.03)

- [X] 구매 확정 프로세스
  - [X] 구매 확정 버튼 및 확인 모달
  - [X] 구매 확정 처리 Action

### 4.3 마이페이지

- [X] 프로필 관리
  - [X] 내 정보 수정 페이지
  - [X] 배송지 관리 기능
  - [X] 프로필 페이지 텍스트 크기 조정 (1.5배 축소)

### 4.4 고객센터 (R.AI.01 관련)

- [X] 고객센터 페이지 구현
  - [X] 새 문의 작성 폼
  - [X] 내 문의 내역 조회
  - [X] 탭 전환 UI
  - [X] 파일 첨부 기능
  - [X] AI 답변 생성 기능
    - [X] Gemini API 연동
    - [X] 문의 유형별 프롬프트 템플릿
    - [X] 도매 관련 질문 필터링
    - [X] Server Action으로 문의 저장 및 AI 답변 생성
  - [X] 피드백 기능
    - [X] "네"/"아니요" 버튼 클릭 표시 (배경색 채우기)
    - [X] 피드백 저장 기능
    - [X] 중복 클릭 방지 (한 번만 선택 가능)

---

## Phase 5 AI & 최적화 🤖

PRD 3.6 섹션 참조.

### 5.1 AI 인터페이스 (R.AI)

- [ ] AI 챗봇 (R.AI.01, R.AI.02)
  - [ ] Floating Action Button (FAB)
  - [ ] Command Palette 통합 질의
- [ ] 지능형 응답 (R.AI.03, R.AI.04)
  - [ ] 배송 가능 여부 질의 처리
  - [ ] 응답 내 PII 마스킹 처리

### 5.2 최적화 및 테스트

- [ ] 성능 최적화
  - [ ] 이미지 최적화 및 Lazy Loading
  - [ ] Supabase Storage 이미지 도메인 설정
    - [ ] `next.config.ts`의 `images.remotePatterns`에 Supabase Storage 도메인 추가
    - [ ] 예 `{ hostname .supabase.co, protocol https }` 또는 특정 프로젝트 도메인
    - [ ] Next.js Image 컴포넌트에서 Supabase Storage 이미지 사용 시 필수 설정
- [ ] 테스트
  - [ ] 주요 시나리오 E2E 테스트

---

 Note 이 문서는 소매점(Retailer) 기능 개발만을 추적합니다. 도매점 및 관리자 기능은 포함되지 않습니다.
